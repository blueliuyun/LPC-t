/*
 * (1) Macro : va_start
 *     #define va_start(ap,v) ( ap = (va_list)&v + _INTSIZEOF(v) )
 *     ???????????????????????????, ???????????????§Ö?????§Ò?, ??????????????????????????????????.
 *
 * (2) In this example, if the file myfile.txt does not exist, PrintFError is called to show an error message similar to:
 *     Error opening file 'myfile.txt'
 *
 * (3) VA_LIST ????C?????§ß??????????????, ????????: #include <stdarg.h>
 *     typedef char *  va_list;		==?????????==	d:\Program Files1\Microsoft Visual Studio 9.0\VC\include\vadefs.h
 *
 * (4) #define va_arg(ap,t) ( *(t *)((ap += _INTSIZEOF(t)) - _INTSIZEOF(t)) ) ??
 *     type va_arg (va_list ap, type)
 *     ????????????, ???????? ap ????????????????????????, ???????????????????????????
 * 
 * (5) ????   int vsnprintf (char * s, size_t n, const char * format, va_list arg ); 
 *     vsnprintf ?¡Â??????? vsprintf, ??????? size_t n ??????, ?????????????size_t n ? format ?????›¥?????§³??
 */
#include <stdio.h>
#include <stdarg.h>
#include <string.h>

// Macro
#define CLI_TAG   "\e[63m"  /* CLI TAG, use ESC characters, c(cli) ascii is 63 */

//
void PrintFError(const char * format, ... );
long long aos_print_long_long(void);

int main()
{
	FILE * pFile;
	char szFileName[] = "myFile.txt";

	pFile = fopen(szFileName, "r");
	if(pFile == NULL) {
		PrintFError("Error opening '%s'", szFileName);
	} else {
		fclose(pFile);
	}

	printf("Test %I64d.\r\n", aos_print_long_long());

    system("pause");
	return 0;
}

/*
 *
 */
void PrintFError(const char * format, ... ) 
{	
	va_list args;
	char *pos, message[256];
	int sz;
	
	// Init
	memset(message, '\0', sizeof(message));

	strcpy(message, CLI_TAG);
	sz = strlen(CLI_TAG);
	pos = message + sz;

	// TODO
	va_start(args, format);  // args ?????,??????????????????
	vsnprintf(pos, 256, format, args); 
	va_end(args);  // ??????????§¹
	printf("%s\r\n", message);
}

/*
 *	
 */
long long aos_print_long_long(void)
{
	return 0xFFFFFFFFFFFFFFF;
}
